{% extends "base.html" %}

{% block content %}

	{% if submission_form.errors %}
		{% if 'vcf' in submission_form.errors and 'uri' in submission_form.errors %}
			<h3>You need to specify at least one upload method</h3>
		{% endif %}
	{% endif %}

	<p>Homozygosity Mapping is a powerful technique used to narrow the search space for disease-causing variants in exome sequencing data. This has traditionally been performed using a separate micro-array based experiment, but with costs of exomes continuing to fall, homozygosity mapping can be performed using only exome sequence.</p>

	<p>This homozygosity mapping tool can retain the region containing the disease-causing variant in a consanguineous pedigree, while eliminating XXX% of identified variants from consideration.</p>

	<h3>To get started, give me <a href="http://www.1000genomes.org/node/101" title="The VCF Format">a VCF file</a></h3>

	<ul class="nav nav-tabs" id="navigation">
		<li class="active"><a href="#tab-upload" data-toggle="tab">Upload file</a></li>
		<li><a href="#tab-uri" data-toggle="tab">Submit via URI</a></li>
		<li><a href="#tab-params" data-toggle="tab">Customize Analysis</a></li>
	</ul>

	<form id="vcfupload" action="/" method="POST" enctype="multipart/form-data">
		{{ submission_form.csrf_token }}

		<div class="tab-content">

			<div class="tab-pane active" id="tab-upload">

				{# Upload form #}
				<div class="fileupload fileupload-new" data-provides="fileupload">
					<div class="input-append">
						<div class="uneditable-input span5">
							<i class="icon-file fileupload-exists"></i> 
							<span class="fileupload-preview"></span>
						</div>
						<span class="hide-after-submit btn btn-file">
							<span class="fileupload-new"><i class="icon-file"></i> Select a file</span>
							<span class="hide-after-submit fileupload-exists"><i class="icon-repeat"></i> Change</span>
							{{ submission_form.vcf(id="vcf") }}
						</span>
						<a href="#" class="btn hide-after-submit fileupload-exists" data-dismiss="fileupload"><i class="icon-remove-circle"></i> Remove</a>
						<button type="submit" id="submit" class="btn btn-success">Submit <i class="icon-chevron-right icon-white"></i></button>
					</div>
				</div>

				{# Error messages #}
				<span id="vcf-error-messages" class="label label-important label-error">{% for error in submission_form.vcf.errors %}{{ error }}{% endfor %}</span>

				{# Progress bar #}
				<div class="row" id="visual-progress" style="display:none;">
					<div class="span11">
						<div id="progress" class="progress progress-success progress-striped active">
							<div class="bar" style="width: 0%;"></div>
						</div>
					</div>
					<div class="span1">
						<div class="percent"></div>
					</div>
				</div>

				{# Upload information #}
				<div class="row">

					<div class="span7">
						<small>
							<ul>
								<li>Supported file extensions are <strong>{{ config.UPLOAD_FORMAT_EXTENSIONS|make_comma_list }}</strong>. <strong>If compressed</strong>, your upload should contain a <em>single</em> VCF file at <em>zero depth</em> when extracted (i.e., don't put your VCF input inside a folder before you compress).</li>
								<li>Uploads are limited to <strong>100MB</strong>.</li>
								<li>Jobs are processed in the order in which they are submitted.</li>
								<li>There's no limit on the number of analyses you can request.</li>
							</ul>
						</small>
					</div>

					{# Demo data #}
					<div class="span5">
						<div class="pull-left">
							<a href="/static/sample.vcf" id="download-sample"><span>Download a sample VCF input file</span></a>
						</div>
						<p><small>No data? No problem! Download the sample VCF file to try out this site.</small></p>
					</div>

				</div>

			</div>
			<div class="tab-pane" id="tab-uri">

				<div class="row">
					<div class="span7">
						<span id="uri-error-messages" class="label label-important label-error">{% for error in submission_form.vcf.errors %}{{ error }}{% endfor %}</span>
						<div class="input-append">
							{{ submission_form.uri(class="span5") }}
							<button id="uri-submit" type="submit" class="btn btn-success">Go <i class="icon-chevron-right icon-white"></i></button>
						</div>
						<br />
						<small id="uri-example">
							<strong>E.g.</strong> <code>http://www.example.com/input.vcf</code>
							<span style="display:none;">
								<br />
								<img src="/static/img/wait.gif" /> Attempting to fetch remote file. This might take a while depending on size and connection speed.
							</span>
						</small>
					</div>
					<div class="span5" id="uri-info">
						<small>
							You can link to a raw VCF file or any compatible compression format.
							<br />
							If you specify a remote file without an extension, I'll assume it's in VCF format.
						</small>
					</div>
				</div>

			</div>
			<div class="tab-pane" id="tab-params">

				<p>Once you're done here, you can go back to either uploading a VCF or specifying a remote URI I can fetch it from.</p>

				<table class="table table-bordered table-condensed token-analysis-params-index" id="token-analysis-params">
					<tbody>
						<tr>
							<th scope="row">Minimum Variant Quality</th>
							<td>{{ submission_form.min_variant_quality(class="span3") }} <span id="min_variant_quality-value">{{ submission_form.min_variant_quality.default }}</span></td>
						</tr>
						<tr>
							<th scope="row">Minimum Quality by Depth</th>
							<td>{{ submission_form.min_quality_depth(class="span3") }}</td>
						</tr>
						<tr>
							<th scope="row">Homozygosity Window Size</th>
							<td>{{ submission_form.homozyg_window_size(class="span3") }}</td>
						</tr>
						<tr>
							<th scope="row">Heterozygous Calls Allowed in Window</th>
							<td>{{ submission_form.heterozyg_calls(class="span3") }}</td>
						</tr>
					</tbody>
				</table>

			</div>

		</div>{# End tab-content #}

	</form>

	<hr />

	<div class="row">
		<div class="span7">
			<h3>Have a token?</h3>
			<form id="tokencheck" action="/token/check" method="POST" enctype="multipart/form-data">
				{{ token_form.csrf_token }}
				<span id="tokencheck-messages" class="label label-important label-error"></span>
				<div class="input-append">
					{{ token_form.token(class="span5", required="required") }}
					<button id="token-submit" type="submit" class="btn btn-success">Check  <i class="icon-chevron-right icon-white"></i></button>
				</div>
				{% if session['last_token'] %}
				<small>Your most recent submission was called &#8220;<a id="last-submission" href="/token/{{ session['last_token'] }}">{{ session['last_token'] }}</a>&#8221;.</small>				
				{% endif %}
			</form>
		</div>
		<div class="span5">
			<h4>Publication</h4>
			<p>
				<big><strong><a href="#" title="Link to paper describing this tool">Homozygosity Mapping Using Only Exome Data</a></strong></big>
				<br />
				<small>
					Adam P. DeLuca, V. Nikhil Anand, Todd E. Scheetz, Edwin M. Stone, and Terry A. Braun
				</small>
			</p>
		</div>
	</div>

{% endblock %}
